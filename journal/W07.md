[← Tillbaka](../README.md)

# Vecka 7 (v.8)

Denna veckan blev mitt huvudfokus på att räkna ut data som vi ska använda på Romas yieldsida. Datan som ska visas på sidan är uträkningar av flera olika tester (beroende av vilka filter användaren valt) och hur deras resultat ser ut i en helhet. Då det är väldigt mycket data som behöver räknas på så ska det göras direkt i databasen, med hjälp av en MongoDB aggregations pipeline, och eftersom vi behöver hämta data från en av våra databaser så ska uträkningen göras i projektet Kraftwerk. En av anledningarna till varför vi inte hämtar från databasen direkt i Roma är för separering av funktionalitet och en annan är för att vi inte vill öppna upp hela databasen till användaren, utan bara de queries som är nödvändiga för dem.

Att skapa själva endpointen och topicen innebar inga större bekymmer utan var ganska lätt. Jag började med att konfigurera vad för addresser de skulle ha innan jag gick vidare till att definiera vilka parametrar som skulle godkännas. Detta gjorde jag genom att kolla över den inkommande datan och kolla så att alla fält som skickades in, var de jag godkänt skulle få komma in. Några av fälten var obligatoriska (ex. Enhetstyp, Start- och Slutdatum) så dessa var jag också tvungen att kolla så de faktiskt var med också. Sedan kollar jag över alla fälten för att se till så det är av rätt typ och inte kommer skapa problem senare. Om det är något som inte skulle stämma under dessa stegen så skulle anropet avslutas tidigt och användaren skulle få veta vad det är som gått snett.

När den första delen av min uppgift var klar bestämde jag mig för att passa på och skriva dokumentationen för endpointen och topicen. Dokumentationen inkluderar adressen för anropet samt in parametrar (namn, typer, osv.) och vad för respons som kan förväntas.

Den sista delen, själva aggregationen var faktiskt ganska krånglig att få till. Jag började med att konfigurera filter sektionen av pipelinen, denna delen behövde vara ganska dynamisk eftersom anropets filter inte alltid har samma värde. Det fanns också en del edge-cases som jag behövde ta hänsyn till, exempelvis så saknar äldre test resultat fältet TestType som indikerar vad för typ av test det är. Som väl är genomfördes endast test av en specifik typ under denna tiden vilket innebär att vi kan anta att värdet är denna typen när det saknas från ett dokument. Mycket mer än filtrerings delen av pipelinen hann jag inte med denna veckan då vi hade ett catch up-möte om Roma och sedan var veckan slut.
